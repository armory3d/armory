package armory.n64;

/**
 * N64 Configuration - Centralized settings for N64 code generation.
 *
 * This file defines what APIs, types, and classes are supported on N64,
 * and how coordinate systems should be converted.
 */
class N64Config {

    // ========================================
    // Member Skip List
    // ========================================
    // Members to skip during extraction (API objects handled specially or not supported)
    public static var skipMembers:Map<String, Bool> = [
        // Transform/object references (handled via obj pointer)
        "object" => true,
        "transform" => true,
        "name" => true,

        // Input (converted to N64 input API)
        "gamepad" => true,
        "keyboard" => true,
        "mouse" => true,

        // Physics (not supported on N64)
        "physics" => true,
        "rb" => true,
        "rigidBody" => true,
    ];

    // ========================================
    // Unsupported Classes
    // ========================================
    // Class identifiers that should emit Skip (not available on N64)
    public static var unsupportedClasses:Map<String, Bool> = [
        // Physics
        "PhysicsWorld" => true,
        "RigidBody" => true,
        "PhysicsConstraint" => true,
        "ContactPair" => true,

        // Animation/Tween
        "Tween" => true,
        "Timeline" => true,

        // Audio
        "Audio" => true,
        "Sound" => true,
        "SoundChannel" => true,

        // Networking
        "Network" => true,
        "Net" => true,
        "Http" => true,

        // Video
        "Video" => true,

        // Advanced rendering
        "RenderPath" => true,
        "Compositor" => true,
    ];

    // ========================================
    // Supported Member Types
    // ========================================
    // Types that can be extracted as trait data members
    public static var supportedTypes:Map<String, Bool> = [
        // Primitives
        "Float" => true,
        "float" => true,
        "Int" => true,
        "int" => true,
        "Bool" => true,
        "bool" => true,
        "String" => true,

        // Vectors
        "Vec2" => true,
        "Vec3" => true,
        "Vec4" => true,

        // Scene reference
        "SceneId" => true,
    ];

    // ========================================
    // Button Mapping (Armory → N64)
    // ========================================
    public static var buttonMap:Map<String, String> = [
        // Face buttons
        "cross" => "N64_BTN_A",
        "a" => "N64_BTN_A",
        "circle" => "N64_BTN_B",
        "b" => "N64_BTN_B",

        // Start
        "start" => "N64_BTN_START",

        // Shoulder/trigger
        "l" => "N64_BTN_L",
        "r" => "N64_BTN_R",
        "z" => "N64_BTN_Z",
        "l1" => "N64_BTN_L",
        "r1" => "N64_BTN_R",
        "l2" => "N64_BTN_Z",
        "r2" => "N64_BTN_Z",

        // D-pad
        "up" => "N64_BTN_DU",
        "down" => "N64_BTN_DD",
        "left" => "N64_BTN_DL",
        "right" => "N64_BTN_DR",
        "dup" => "N64_BTN_DU",
        "ddown" => "N64_BTN_DD",
        "dleft" => "N64_BTN_DL",
        "dright" => "N64_BTN_DR",

        // C buttons (N64 specific)
        "cup" => "N64_BTN_CU",
        "cdown" => "N64_BTN_CD",
        "cleft" => "N64_BTN_CL",
        "cright" => "N64_BTN_CR",
    ];

    // ========================================
    // Math Function Mapping (Haxe → C)
    // ========================================
    public static var mathMap:Map<String, String> = [
        // Basic
        "sqrt" => "sqrtf",
        "abs" => "fabsf",

        // Trigonometry
        "sin" => "sinf",
        "cos" => "cosf",
        "tan" => "tanf",
        "asin" => "asinf",
        "acos" => "acosf",
        "atan" => "atanf",
        "atan2" => "atan2f",

        // Rounding
        "floor" => "floorf",
        "ceil" => "ceilf",
        "round" => "roundf",

        // Power/exp
        "pow" => "powf",
        "exp" => "expf",
        "log" => "logf",

        // Min/max
        "min" => "fminf",
        "max" => "fmaxf",

        // Constants
        "PI" => "M_PI",
        "POSITIVE_INFINITY" => "INFINITY",
        "NEGATIVE_INFINITY" => "-INFINITY",
        "NaN" => "NAN",
    ];

    // ========================================
    // Coordinate System Conversion
    // ========================================
    // Blender: X=right, Y=forward, Z=up (right-handed)
    // N64:     X=right, Y=up, Z=forward (right-handed, Y-up)
    // Conversion: (bX, bY, bZ) → (bX, bZ, -bY)

    public static inline var COORD_BLENDER_X = "x";  // → N64 X
    public static inline var COORD_BLENDER_Y = "y";  // → N64 -Z
    public static inline var COORD_BLENDER_Z = "z";  // → N64 Y

    // ========================================
    // Helper Functions
    // ========================================

    public static function shouldSkipMember(name:String):Bool {
        return skipMembers.exists(name);
    }

    public static function isUnsupportedClass(name:String):Bool {
        return unsupportedClasses.exists(name);
    }

    public static function isSupportedType(typeName:String):Bool {
        return supportedTypes.exists(typeName);
    }

    public static function mapButton(button:String):String {
        var lower = button.toLowerCase();
        return buttonMap.exists(lower) ? buttonMap.get(lower) : "N64_BTN_A";
    }

    public static function mapMathFunc(func:String):String {
        return mathMap.exists(func) ? mathMap.get(func) : func;
    }

    public static function isMathConstant(func:String):Bool {
        return func == "PI" || func == "POSITIVE_INFINITY" ||
               func == "NEGATIVE_INFINITY" || func == "NaN";
    }
}
