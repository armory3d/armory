#include <libdragon.h>
#include <t3d/t3d.h>
#include <t3d/t3dmodel.h>

#include "models.h"

static const char *MODEL_PATHS[MODEL_COUNT] = {{
{mesh_paths}
}};

typedef struct {{
    T3DModel *model;
    int loaded;
}} ModelEntry;

static ModelEntry g_models[MODEL_COUNT];

void models_init(void)
{{
    for (int i = 0; i < MODEL_COUNT; ++i) {{
        g_models[i].model = NULL;
        g_models[i].loaded = 0;
    }}
}}

void models_shutdown(void)
{{
    for (int i = 0; i < MODEL_COUNT; ++i) {{
        if (g_models[i].loaded && g_models[i].model) {{
            t3d_model_free(g_models[i].model);
            g_models[i].model = NULL;
            g_models[i].loaded = 0;
        }}
    }}
}}

T3DModel *models_get(ModelId id)
{{
    if (id < 0 || id >= MODEL_COUNT) {{
        return NULL;
    }}

    ModelEntry *e = &g_models[id];
    if (!e->loaded) {{
        const char *path = MODEL_PATHS[id];
        e->model = t3d_model_load(path);
        e->loaded = 1;
    }}
    return e->model;
}}
