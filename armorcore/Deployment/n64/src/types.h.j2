#pragma once

#include <stdint.h>
#include <rspq.h>
#include <t3d/t3dmath.h>
#include <t3d/t3dmodel.h>

#ifdef __cplusplus
extern "C" {{
#endif

#define FB_COUNT 3
#define MAX_TRAITS {max_traits}

typedef void (*ArmTraitReadyFn)(void *entity);
typedef void (*ArmTraitUpdateFn)(void *entity, float dt);
typedef void (*ArmTraitRemoveFn)(void *entity);

typedef struct {{
    ArmTraitReadyFn on_ready;
    ArmTraitUpdateFn on_update;
    ArmTraitRemoveFn on_remove;
    void *data;
}} ArmTrait;

typedef struct ArmObject {{
    float pos[3];
    float rot[3];
    float scale[3];

    rspq_block_t *dpl;
    T3DMat4FP *model_mat;

    uint8_t trait_count;
    ArmTrait traits[MAX_TRAITS];
}} ArmObject;

typedef struct ArmLight {{
    uint8_t color[4];
    T3DVec3 dir;

    uint8_t trait_count;
    ArmTrait traits[MAX_TRAITS];
}} ArmLight;

typedef struct ArmCamera {{
    T3DVec3 pos;
    T3DVec3 target;
    float fov;
    float near;
    float far;

    uint8_t trait_count;
    ArmTrait traits[MAX_TRAITS];
}} ArmCamera;

typedef struct {{
    uint8_t clear_color[4];
    uint8_t ambient_color[4];
}} ArmWorld;

typedef struct ArmScene {{
    ArmWorld world;

    uint8_t camera_count;
    ArmCamera *cameras;
    uint8_t active_camera_id;

    uint8_t light_count;
    ArmLight *lights;

    uint16_t object_count;
    ArmObject *objects;

    uint8_t trait_count;
    ArmTrait traits[MAX_TRAITS];
}} ArmScene;

#ifdef __cplusplus
}}
#endif
